<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neopro Admin - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <img src="neopro-logo-white.png" alt="Neopro" height="40">
                <span style="margin-left: 12px; font-family: var(--neo-font-body); font-size: 20px; font-weight: 600;">Admin</span>
            </div>
            <div class="header-info">
                <span id="hostname">Loading...</span>
                <span id="current-time">--:--:--</span>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-tab="dashboard">
                üìä Dashboard
            </button>
            <button class="nav-btn" data-tab="videos">
                üé¨ Vid√©os
            </button>
            <button class="nav-btn" data-tab="network">
                üì° R√©seau
            </button>
            <button class="nav-btn" data-tab="logs">
                üìú Logs
            </button>
            <button class="nav-btn" data-tab="system">
                ‚öôÔ∏è Syst√®me
            </button>
        </nav>

        <!-- Content -->
        <main class="content">

            <!-- Tab: Dashboard -->
            <div id="tab-dashboard" class="tab-content active">
                <h2>√âtat du syst√®me</h2>

                <div class="cards-grid">
                    <!-- CPU Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üíª CPU</h3>
                        </div>
                        <div class="card-body">
                            <div class="metric">
                                <span class="metric-label">Utilisation</span>
                                <span class="metric-value" id="cpu-usage">--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Coeurs</span>
                                <span class="metric-value" id="cpu-cores">--</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="cpu-progress"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Memory Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üß† M√©moire</h3>
                        </div>
                        <div class="card-body">
                            <div class="metric">
                                <span class="metric-label">Utilis√©e</span>
                                <span class="metric-value" id="mem-used">--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Total</span>
                                <span class="metric-value" id="mem-total">--</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="mem-progress"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Temperature Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üå°Ô∏è Temp√©rature</h3>
                        </div>
                        <div class="card-body">
                            <div class="metric-large" id="temperature">--</div>
                        </div>
                    </div>

                    <!-- Disk Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üíæ Stockage</h3>
                        </div>
                        <div class="card-body">
                            <div class="metric">
                                <span class="metric-label">Utilis√©</span>
                                <span class="metric-value" id="disk-used">--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Total</span>
                                <span class="metric-value" id="disk-total">--</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="disk-progress"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Services Status -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîß Services</h3>
                    </div>
                    <div class="card-body">
                        <div class="services-grid" id="services-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Uptime -->
                <div class="info-box">
                    <span>‚è±Ô∏è Uptime: <strong id="uptime">--</strong></span>
                </div>
            </div>

            <!-- Tab: Videos -->
            <div id="tab-videos" class="tab-content">
                <h2>Gestion des vid√©os</h2>

                <!-- Time Categories Editor -->
                <div class="card">
                    <div class="card-header">
                        <h3>‚è±Ô∏è Organisation par temps (T√©l√©commande)</h3>
                        <button class="btn btn-secondary" onclick="refreshTimeCategories()">üîÑ Actualiser</button>
                    </div>
                    <div class="card-body">
                        <p class="info-text">
                            Associez vos cat√©gories de vid√©os aux diff√©rents moments du match pour la t√©l√©commande.
                        </p>
                        <div id="time-categories-list" class="time-categories-list">
                            <!-- Populated by JS -->
                        </div>
                        <button class="btn btn-primary" onclick="addTimeCategory()" style="margin-top: 16px;">
                            ‚ûï Ajouter un bloc temps
                        </button>
                    </div>
                </div>

                <!-- Categories Manager -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìÇ Gestion des cat√©gories</h3>
                        <button class="btn btn-secondary" onclick="refreshCategories()">üîÑ Actualiser</button>
                    </div>
                    <div class="card-body">
                        <p class="info-text">
                            Cr√©ez et organisez vos cat√©gories et sous-cat√©gories de vid√©os.
                        </p>
                        <div id="categories-manager" class="categories-manager">
                            <!-- Populated by JS -->
                        </div>
                        <button class="btn btn-primary" onclick="addCategory()" style="margin-top: 16px;">
                            ‚ûï Nouvelle cat√©gorie
                        </button>
                    </div>
                </div>

                <!-- Upload Form -->
                <div class="card">
                    <div class="card-header">
                        <h3>üì§ Upload une vid√©o</h3>
                    </div>
                    <div class="card-body">
                        <form id="upload-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="video-file">Fichier vid√©o (MP4, MKV, MOV - max 500MB)</label>
                                <input type="file" id="video-file" name="video" accept="video/*" required>
                            </div>
                            <div class="form-group">
                                <label for="video-category">Cat√©gorie</label>
                                <select id="video-category" name="category" required>
                                    <option value="">-- Chargement... --</option>
                                </select>
                            </div>
                            <div class="form-group" id="subcategory-group" style="display: none;">
                                <label for="video-subcategory">Sous-cat√©gorie</label>
                                <select id="video-subcategory" name="subcategory">
                                    <option value="">-- S√©lectionner --</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                üì§ Upload
                            </button>
                        </form>
                        <div id="upload-progress" class="upload-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="upload-progress-bar"></div>
                            </div>
                            <span id="upload-status">Uploading...</span>
                        </div>
                    </div>
                </div>

                <!-- Videos List -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìÅ Biblioth√®que vid√©os</h3>
                        <button class="btn btn-secondary" onclick="refreshVideos()">üîÑ Actualiser</button>
                    </div>
                    <div class="card-body">
                        <div class="videos-list" id="videos-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Network -->
            <div id="tab-network" class="tab-content">
                <h2>Configuration r√©seau</h2>

                <!-- WiFi Client Config -->
                <div class="card">
                    <div class="card-header">
                        <h3>üì° WiFi Client (Acc√®s distant)</h3>
                    </div>
                    <div class="card-body">
                        <p class="info-text">
                            Configurez le Raspberry Pi pour se connecter au WiFi local du club.
                            Cela permet l'acc√®s SSH distant pour les mises √† jour.
                        </p>
                        <form id="wifi-form">
                            <div class="form-group">
                                <label for="wifi-ssid">SSID du WiFi</label>
                                <input type="text" id="wifi-ssid" name="ssid" required>
                            </div>
                            <div class="form-group">
                                <label for="wifi-password">Mot de passe</label>
                                <input type="password" id="wifi-password" name="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                üíæ Configurer
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Network Info -->
                <div class="card">
                    <div class="card-header">
                        <h3>üåê Informations r√©seau</h3>
                        <button class="btn btn-secondary" onclick="refreshNetwork()">üîÑ Actualiser</button>
                    </div>
                    <div class="card-body">
                        <div id="network-info">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Logs -->
            <div id="tab-logs" class="tab-content">
                <h2>Logs syst√®me</h2>

                <div class="card">
                    <div class="card-header">
                        <h3>üìú Logs</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm active" data-log="app">Application</button>
                            <button class="btn btn-sm" data-log="nginx">Nginx</button>
                            <button class="btn btn-sm" data-log="system">Syst√®me</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="logs-container">
                            <pre id="logs-content">Chargement des logs...</pre>
                        </div>
                        <button class="btn btn-secondary" onclick="refreshLogs()">üîÑ Actualiser</button>
                    </div>
                </div>
            </div>

            <!-- Tab: System -->
            <div id="tab-system" class="tab-content">
                <h2>Administration syst√®me</h2>

                <!-- Services Control -->
                <div class="card">
                    <div class="card-header">
                        <h3>üîß Contr√¥le des services</h3>
                    </div>
                    <div class="card-body">
                        <div class="services-control">
                            <div class="service-control-item">
                                <span>Application Neopro</span>
                                <button class="btn btn-warning" onclick="restartService('neopro-app')">
                                    üîÑ Red√©marrer
                                </button>
                            </div>
                            <div class="service-control-item">
                                <span>Serveur Web (Nginx)</span>
                                <button class="btn btn-warning" onclick="restartService('nginx')">
                                    üîÑ Red√©marrer
                                </button>
                            </div>
                            <div class="service-control-item">
                                <span>Mode Kiosque</span>
                                <button class="btn btn-warning" onclick="restartService('neopro-kiosk')">
                                    üîÑ Red√©marrer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Update System -->
                <div class="card">
                    <div class="card-header">
                        <h3>üì¶ Mise √† jour</h3>
                    </div>
                    <div class="card-body">
                        <p class="info-text">
                            Uploadez une archive de mise √† jour (.tar.gz) pour mettre √† jour l'application.
                            Un backup automatique sera cr√©√©.
                        </p>
                        <form id="update-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="update-file">Archive de mise √† jour (.tar.gz)</label>
                                <input type="file" id="update-file" name="package" accept=".tar.gz" required>
                            </div>
                            <button type="submit" class="btn btn-warning">
                                üì¶ Mettre √† jour
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Power Controls -->
                <div class="card danger-zone">
                    <div class="card-header">
                        <h3>‚ö†Ô∏è Zone dangereuse</h3>
                    </div>
                    <div class="card-body">
                        <div class="power-controls">
                            <button class="btn btn-danger" onclick="confirmAction('reboot')">
                                üîÑ Red√©marrer le syst√®me
                            </button>
                            <button class="btn btn-danger" onclick="confirmAction('shutdown')">
                                üî¥ √âteindre le syst√®me
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="footer">
            <span>Neopro v1.0.0 | Raspberry Pi Admin Panel</span>
            <span id="last-update">Derni√®re mise √† jour: --</span>
        </footer>
    </div>

    <!-- Edit Video Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content modal-content-wide">
            <h3>Modifier la vid√©o</h3>
            <p id="edit-current-path" class="modal-subtitle"></p>
            <form id="edit-video-form">
                <input type="hidden" id="edit-original-path">
                <div class="form-group">
                    <label for="edit-display-name">Nom affich√©</label>
                    <input type="text" id="edit-display-name" placeholder="Nom visible sur la t√©l√©commande">
                </div>
                <div class="form-group">
                    <label for="edit-category">Cat√©gorie</label>
                    <input type="text" id="edit-category" list="edit-category-options" placeholder="Ex: Match_SM1" required>
                </div>
                <div class="form-group">
                    <label for="edit-subcategory">Sous-cat√©gorie</label>
                    <input type="text" id="edit-subcategory" list="edit-subcategory-options" placeholder="Ex: But">
                    <small class="form-hint">Laissez vide pour enregistrer la vid√©o directement dans la cat√©gorie.</small>
                </div>
                <div class="form-group">
                    <label for="edit-filename">Nom du fichier (avec extension)</label>
                    <input type="text" id="edit-filename" required>
                    <small class="form-hint">Le nom de fichier doit conserver l'extension (.mp4, .mkv, ...).</small>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">üíæ Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
    <datalist id="edit-category-options"></datalist>
    <datalist id="edit-subcategory-options"></datalist>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Confirmation</h3>
            <p id="modal-message"></p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                <button class="btn btn-danger" id="modal-confirm">Confirmer</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

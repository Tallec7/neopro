# Configuration Render.com pour NEOPRO
# Base de donn√©es : Supabase (externe)

services:
  # ============================================
  # CENTRAL SERVER (API Backend)
  # ============================================
  - type: web
    name: neopro-central
    env: node
    region: frankfurt
    plan: starter
    rootDirectory: central-server
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3001
      - key: API_VERSION
        value: v1
      # DATABASE_URL : configurer manuellement dans Render Dashboard
      # Format: postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres
      - key: DATABASE_URL
        sync: false
      - key: DATABASE_SSL
        value: "true"
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: 8h
      - key: ALLOWED_ORIGINS
        value: https://neopro-dashboard.onrender.com,https://control.neopro.fr
      - key: LOG_LEVEL
        value: info
      - key: STORAGE_TYPE
        value: local
      - key: STORAGE_PATH
        value: /data/videos

  # ============================================
  # CENTRAL DASHBOARD (Admin Frontend)
  # ============================================
  - type: web
    name: neopro-dashboard
    env: static
    region: frankfurt
    rootDirectory: central-dashboard
    buildCommand: npm install && npm run build:prod
    staticPublishPath: dist/neopro-dashboard
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    headers:
      - path: /*
        name: X-Frame-Options
        value: SAMEORIGIN
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: X-XSS-Protection
        value: 1; mode=block
    envVars:
      - key: NODE_VERSION
        value: "18"

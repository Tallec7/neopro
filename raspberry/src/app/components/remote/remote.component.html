<!-- Vue s√©lection de club (mode d√©mo) -->
@if (currentView === 'club-selector') {
  <app-club-selector (clubSelected)="onClubSelected($event)"></app-club-selector>
} @else {
  <div class="remote-container">
    <!-- Header avec breadcrumb -->
    <div class="remote-header">
      <div class="header-content">
        <div class="header-left">
          @if (breadcrumb.length > 1 || isSearching) {
            <button class="back-button" (click)="handleBack()">
              <span class="back-icon">‚Üê</span>
            </button>
          }
          @if (isDemoMode && breadcrumb.length === 1 && !isSearching) {
            <button class="back-button" (click)="backToClubSelector()">
              <span class="back-icon">‚Üê</span>
            </button>
          }
          <div class="header-title-section">
            @if (isSearching) {
              <h1 class="header-title">Recherche</h1>
              <div class="breadcrumb-path">
                <span
                  >{{ searchResults.length }} r√©sultat{{
                    searchResults.length !== 1 ? 's' : ''
                  }}</span
                >
              </div>
            } @else {
              <h1 class="header-title">{{ breadcrumb[breadcrumb.length - 1] }}</h1>
              @if (isDemoMode && breadcrumb.length === 1 && configuration) {
                <div class="breadcrumb-path">
                  <span>{{ configuration.auth?.clubName || 'Club' }}</span>
                </div>
              }
              @if (breadcrumb.length > 1) {
                <div class="breadcrumb-path">
                  @for (item of breadcrumb.slice(0, -1); track item; let i = $index) {
                    <span>{{ item }}</span>
                    @if (i < breadcrumb.length - 2) {
                      <span>/</span>
                    }
                  }
                </div>
              }
            }
          </div>
        </div>

        <div class="header-right">
          <!-- Widget Score en Live minimaliste (si activ√©) -->
          @if (liveScoreEnabled) {
            <div class="score-mini">
              <button class="score-mini-btn" (click)="decrementHomeScore()">‚àí</button>
              <span class="score-mini-value">{{ currentScore.homeScore }}</span>
              <span class="score-mini-sep">-</span>
              <span class="score-mini-value">{{ currentScore.awayScore }}</span>
              <button class="score-mini-btn" (click)="incrementAwayScore()">+</button>
              <button class="score-mini-reset" (click)="resetScore()" title="Reset">‚Ü∫</button>
            </div>
          }

          <!-- Badge estimation audience -->
          <button class="audience-badge" (click)="openMatchModal()" title="Configuration match">
            <span class="badge-icon">üë•</span>
            <span class="badge-value">{{ matchInfo.audienceEstimate }}</span>
            <span class="badge-edit">‚úèÔ∏è</span>
          </button>

          <!-- Bouton actualiser (visible seulement en mode normal, pas d√©mo) -->
          @if (!isDemoMode && breadcrumb.length === 1 && !isSearching) {
            <button class="reload-button" (click)="reloadConfiguration()" [disabled]="isReloading">
              <span class="reload-icon" [class.spinning]="isReloading">üîÑ</span>
            </button>
          }
        </div>
      </div>

      <!-- Barre de recherche (visible sur la page d'accueil) -->
      @if (currentView === 'home' || isSearching) {
        <div class="search-bar">
          <input
            type="text"
            class="search-input"
            placeholder="Rechercher une vid√©o..."
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
            (keyup.escape)="clearSearch()"
          />
          @if (searchQuery) {
            <button class="search-clear" (click)="clearSearch()">‚úï</button>
          } @else {
            <span class="search-icon">üîç</span>
          }
        </div>
      }
    </div>

    <div class="remote-content">
      <!-- R√©sultats de recherche -->
      @if (isSearching) {
        <div class="view-search-results">
          @if (searchResults.length === 0) {
            <div class="empty-state">
              <span class="empty-icon">üîç</span>
              <h3>Aucun r√©sultat</h3>
              <p>Aucune vid√©o ne correspond √† "{{ searchQuery }}"</p>
            </div>
          } @else {
            <div class="videos-list">
              @for (video of searchResults; track video.path) {
                <button class="video-card" (click)="launchVideo(video)">
                  <div class="video-icon-wrapper">
                    <span class="video-icon">üé¨</span>
                  </div>
                  <div class="video-info">
                    <h3 class="video-title">{{ video.name }}</h3>
                    <span class="video-path">{{ video.path }}</span>
                  </div>
                  <span class="video-play">‚ñ∂</span>
                </button>
              }
            </div>
          }
        </div>
      }

      <!-- Vue principale - Accueil -->
      @if (currentView === 'home' && !isSearching) {
        <div class="view-home">
          <!-- Actions rapides -->
          <div class="quick-actions">
            <button class="quick-action sponsors-action" (click)="launchSponsors()">
              <span class="action-icon">üë•</span>
              <div class="action-content">
                <div class="action-title">Boucle partenaires</div>
                <div class="action-subtitle">Lancer la rotation automatique</div>
              </div>
            </button>

            <button class="quick-action all-videos-action" (click)="showAllVideos()">
              <span class="action-icon">üé¨</span>
              <div class="action-content">
                <div class="action-title">Toutes les vid√©os</div>
                <div class="action-subtitle">{{ getTotalVideosCount() }} vid√©os disponibles</div>
              </div>
            </button>
          </div>

          <!-- Cat√©gories par temps -->
          <div class="time-categories-section">
            <h2 class="section-title">Organisation par temps</h2>
            <div class="time-categories-grid">
              @for (timeCategory of timeCategories; track timeCategory.name) {
                <button
                  class="time-category-card"
                  [ngClass]="timeCategory.color"
                  (click)="selectTimeCategory(timeCategory)"
                >
                  <div class="card-header">
                    <span class="card-icon">{{ timeCategory.icon }}</span>
                    <span class="card-arrow">‚Üí</span>
                  </div>
                  <h3 class="card-title">{{ timeCategory.name }}</h3>
                  <p class="card-description">{{ timeCategory.description }}</p>
                  <div class="card-footer">
                    <span class="card-stats">
                      {{ getTotalCategoriesForTimeCategory(timeCategory) }} cat√©gories ‚Ä¢
                      {{ getTotalVideosForTimeCategory(timeCategory) }} vid√©os
                    </span>
                  </div>
                </button>
              }
            </div>
          </div>
        </div>
      }

      <!-- Vue toutes les vid√©os -->
      @if (currentView === 'all-videos') {
        <div class="view-all-videos">
          @if (getAllVideos().length === 0) {
            <div class="empty-state">
              <span class="empty-icon">üì≠</span>
              <h3>Aucune vid√©o</h3>
              <p>Il n'y a pas encore de vid√©os dans cette configuration</p>
            </div>
          } @else {
            <div class="videos-list">
              @for (video of getAllVideos(); track video.path) {
                <button class="video-card" (click)="launchVideo(video)">
                  <div class="video-icon-wrapper">
                    <span class="video-icon">üé¨</span>
                  </div>
                  <div class="video-info">
                    <h3 class="video-title">{{ video.name }}</h3>
                    <span class="video-path">{{ video.path }}</span>
                  </div>
                  <span class="video-play">‚ñ∂</span>
                </button>
              }
            </div>
          }
        </div>
      }

      <!-- Vue cat√©gories d'un temps -->
      @if (currentView === 'time-categories' && selectedTimeCategory) {
        <div class="view-categories">
          @if (getCategoriesForTimeCategory(selectedTimeCategory).length === 0) {
            <div class="empty-state">
              <span class="empty-icon">üì≠</span>
              <h3>Aucune cat√©gorie</h3>
              <p>Aucune cat√©gorie n'est assign√©e √† "{{ selectedTimeCategory.name }}"</p>
            </div>
          } @else {
            <div class="categories-grid">
              @for (
                category of getCategoriesForTimeCategory(selectedTimeCategory);
                track category.name
              ) {
                <button class="category-card" (click)="selectCategory(category)">
                  <div class="category-icon-wrapper">
                    <span class="category-icon">üìÅ</span>
                  </div>
                  <div class="category-info">
                    <h3 class="category-title">{{ category.name }}</h3>
                    <div class="category-meta">
                      @if (getSubCategoriesCount(category) > 0) {
                        <span>
                          {{ getSubCategoriesCount(category) }} sous-cat√©gorie{{
                            getSubCategoriesCount(category) > 1 ? 's' : ''
                          }}
                        </span>
                      }
                      @if (getSubCategoriesCount(category) > 0 && getVideosCount(category) > 0) {
                        <span> ‚Ä¢ </span>
                      }
                      @if (getVideosCount(category) > 0) {
                        <span>
                          {{ getVideosCount(category) }} vid√©o{{
                            getVideosCount(category) > 1 ? 's' : ''
                          }}
                        </span>
                      }
                    </div>
                  </div>
                  <span class="category-arrow">‚Üí</span>
                </button>
              }
            </div>
          }
        </div>
      }

      <!-- Vue sous-cat√©gories -->
      @if (currentView === 'subcategories' && selectedCategory) {
        <div class="view-subcategories">
          @if (getSubCategoriesForDisplay(selectedCategory).length === 0) {
            <div class="empty-state">
              <span class="empty-icon">üì≠</span>
              <h3>Aucune sous-cat√©gorie</h3>
              <p>Cette cat√©gorie ne contient pas de sous-cat√©gories</p>
            </div>
          } @else {
            <div class="subcategories-grid">
              @for (
                subCategory of getSubCategoriesForDisplay(selectedCategory);
                track subCategory.name
              ) {
                <button class="subcategory-card" (click)="selectSubCategory(subCategory)">
                  <div class="subcategory-icon-wrapper">
                    <span class="subcategory-icon">üìÅ</span>
                  </div>
                  <div class="subcategory-info">
                    <h3 class="subcategory-title">{{ subCategory.name }}</h3>
                    <div class="subcategory-meta">
                      {{ subCategory.videos?.length || 0 }} vid√©o{{
                        (subCategory.videos?.length || 0) > 1 ? 's' : ''
                      }}
                    </div>
                  </div>
                </button>
              }
            </div>
          }
        </div>
      }

      <!-- Vue vid√©os -->
      @if (currentView === 'videos') {
        <div class="view-videos">
          @if (getCurrentVideos().length === 0) {
            <div class="empty-state">
              <span class="empty-icon">üé¨</span>
              <h3>Aucune vid√©o</h3>
              <p>Cette cat√©gorie ne contient pas de vid√©os</p>
            </div>
          } @else {
            <div class="videos-list">
              @for (video of getCurrentVideos(); track video.path) {
                <button class="video-card" (click)="launchVideo(video)">
                  <div class="video-icon-wrapper">
                    <span class="video-icon">üé¨</span>
                  </div>
                  <div class="video-info">
                    <h3 class="video-title">{{ video.name }}</h3>
                    <span class="video-path">{{ video.path }}</span>
                  </div>
                  <span class="video-play">‚ñ∂</span>
                </button>
              }
            </div>
          }
        </div>
      }
    </div>

    <!-- Modal configuration match -->
    @if (showMatchModal) {
      <div class="modal-overlay" (click)="closeMatchModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>üìÖ Configuration Match</h2>
            <button class="modal-close" (click)="closeMatchModal()">√ó</button>
          </div>

          <div class="modal-body">
            <!-- Date du match -->
            <div class="form-group">
              <label for="matchDate">Date du match</label>
              <input type="date" id="matchDate" [(ngModel)]="matchInfo.date" class="form-input" />
            </div>

            <!-- Nom du match -->
            <div class="form-group">
              <label for="matchName">Match</label>
              <input
                type="text"
                id="matchName"
                [(ngModel)]="matchInfo.matchName"
                placeholder="CESSON vs NANTES"
                class="form-input"
              />
              <span class="form-hint">Utilisez "vs" pour s√©parer les √©quipes</span>
            </div>

            <!-- Estimation spectateurs -->
            <div class="form-group">
              <label for="audienceEstimate">Spectateurs estim√©s</label>
              <div class="audience-input-group">
                <button class="audience-btn minus" (click)="decrementAudience()">-</button>
                <input
                  type="number"
                  id="audienceEstimate"
                  [(ngModel)]="matchInfo.audienceEstimate"
                  min="0"
                  step="10"
                  class="form-input audience-number"
                />
                <button class="audience-btn plus" (click)="incrementAudience()">+</button>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeMatchModal()">Annuler</button>
            <button class="btn btn-primary" (click)="saveMatchInfo()">Enregistrer</button>
          </div>
        </div>
      </div>
    }
  </div>
}
